---
import BaseLayout from './BaseLayout.astro';
import SchemaOrg from '@components/seo/SchemaOrg.astro';
import ShareButtons from '@components/calculator/ShareButtons.astro';
import EmbedCodeGenerator from '@components/calculator/EmbedCodeGenerator.astro';
import RelatedCalculators from '@components/calculator/RelatedCalculators.astro';
import type { FAQ, BreadcrumbItem } from '@lib/seo/schema';

interface RelatedCalc {
  name: string;
  description: string;
  href: string;
  category: string;
}

interface Props {
  title: string;
  description: string;
  calculatorName: string;
  category: string;
  categorySlug: string;
  slug: string;
  faqs?: FAQ[];
  relatedCalculators?: RelatedCalc[];
  ogImage?: string;
}

const {
  title,
  description,
  calculatorName,
  category,
  categorySlug,
  slug,
  faqs = [],
  relatedCalculators = [],
  ogImage,
} = Astro.props;

const siteUrl = Astro.site?.toString().replace(/\/$/, '') || 'https://calcverse.example.com';
const currentUrl = `${siteUrl}/${categorySlug}/${slug}`;
const embedUrl = `${siteUrl}/embed/${categorySlug}/${slug}`;

const breadcrumbs: BreadcrumbItem[] = [
  { name: 'Home', url: siteUrl },
  { name: category, url: `${siteUrl}/${categorySlug}` },
  { name: calculatorName, url: currentUrl },
];

const calculatorSEO = {
  name: calculatorName,
  description,
  url: currentUrl,
  category,
};
---

<BaseLayout title={title} description={description} ogImage={ogImage}>
  <Fragment slot="head">
    <SchemaOrg calculator={calculatorSEO} faqs={faqs} breadcrumbs={breadcrumbs} />
  </Fragment>

  <article class="max-w-4xl mx-auto px-4 py-8">
    <nav class="text-sm text-gray-500 mb-4">
      <ol class="flex items-center gap-2">
        <li><a href="/" class="hover:text-brand-600">Home</a></li>
        <li>/</li>
        <li><a href={`/${categorySlug}`} class="hover:text-brand-600">{category}</a></li>
        <li>/</li>
        <li class="text-gray-900">{calculatorName}</li>
      </ol>
    </nav>

    <header class="mb-6">
      <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">{calculatorName}</h1>
      <p class="text-lg text-gray-600 mt-2">{description}</p>
    </header>

    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
      <slot />
    </div>

    <div class="grid md:grid-cols-2 gap-6 mb-8">
      <div>
        <h2 class="font-semibold text-gray-900 mb-3">Share Your Results</h2>
        <ShareButtons title={title} url={currentUrl} />
      </div>
      <div>
        <EmbedCodeGenerator embedUrl={embedUrl} title={calculatorName} />
      </div>
    </div>

    {faqs.length > 0 && (
      <section class="mb-8">
        <h2 class="text-xl font-bold text-gray-900 mb-4">Frequently Asked Questions</h2>
        <div class="space-y-4">
          {faqs.map((faq) => (
            <details class="bg-white rounded-xl border border-gray-200 p-4 group">
              <summary class="font-medium text-gray-900 cursor-pointer list-none flex justify-between items-center">
                {faq.question}
                <svg class="w-5 h-5 text-gray-500 group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </summary>
              <p class="mt-3 text-gray-600">{faq.answer}</p>
            </details>
          ))}
        </div>
      </section>
    )}

    <slot name="content" />

    <RelatedCalculators calculators={relatedCalculators} />
  </article>
</BaseLayout>
