---
import BaseLayout from './BaseLayout.astro';
import SchemaOrg from '@components/seo/SchemaOrg.astro';
import ShareButtons from '@components/calculator/ShareButtons.astro';
import EmbedCodeGenerator from '@components/calculator/EmbedCodeGenerator.astro';
import RelatedCalculators from '@components/calculator/RelatedCalculators.astro';
import type { FAQ, BreadcrumbItem } from '@lib/seo/schema';

interface RelatedCalc {
  name: string;
  description: string;
  href: string;
  category: string;
}

interface Props {
  title: string;
  description: string;
  calculatorName: string;
  category: string;
  categorySlug: string;
  slug: string;
  faqs?: FAQ[];
  relatedCalculators?: RelatedCalc[];
  ogImage?: string;
}

const {
  title,
  description,
  calculatorName,
  category,
  categorySlug,
  slug,
  faqs = [],
  relatedCalculators = [],
  ogImage,
} = Astro.props;

const siteUrl = Astro.site?.toString().replace(/\/$/, '') || 'https://calcverse.example.com';
const currentUrl = `${siteUrl}/${categorySlug}/${slug}`;
const embedUrl = `${siteUrl}/embed/${categorySlug}/${slug}`;

const breadcrumbs: BreadcrumbItem[] = [
  { name: 'Home', url: siteUrl },
  { name: category, url: `${siteUrl}/${categorySlug}` },
  { name: calculatorName, url: currentUrl },
];

const calculatorSEO = {
  name: calculatorName,
  description,
  url: currentUrl,
  category,
};

// Category color mappings
const categoryColors: Record<string, { accent: string; light: string; text: string }> = {
  freelance: { accent: 'primary', light: 'freelance-50', text: 'freelance-600' },
  creator: { accent: 'creator', light: 'creator-50', text: 'creator-600' },
  'side-hustle': { accent: 'sidehustle', light: 'sidehustle-50', text: 'sidehustle-600' },
  finance: { accent: 'finance', light: 'finance-50', text: 'finance-600' },
};

const colors = categoryColors[categorySlug] || categoryColors.freelance;
---

<BaseLayout title={title} description={description} ogImage={ogImage}>
  <Fragment slot="head">
    <SchemaOrg calculator={calculatorSEO} faqs={faqs} breadcrumbs={breadcrumbs} />
  </Fragment>

  <div class="bg-neutral-50 min-h-screen">
    <article class="max-w-4xl mx-auto px-4 py-8 md:py-12">
      <!-- Breadcrumbs -->
      <nav class="text-sm text-neutral-500 mb-6">
        <ol class="flex items-center gap-2">
          <li>
            <a href="/" class="hover:text-neutral-900 transition-colors">Home</a>
          </li>
          <li class="text-neutral-300">/</li>
          <li>
            <a href={`/${categorySlug}`} class="hover:text-neutral-900 transition-colors">{category}</a>
          </li>
          <li class="text-neutral-300">/</li>
          <li class="text-neutral-900 font-medium">{calculatorName}</li>
        </ol>
      </nav>

      <!-- Header -->
      <header class="mb-8">
        <h1 class="heading-lg text-neutral-900">{calculatorName}</h1>
        <p class="text-lg text-neutral-600 mt-3 leading-relaxed">{description}</p>
      </header>

      <!-- Calculator Card -->
      <div class="card-elevated-lg p-6 md:p-8 mb-10">
        <slot />
      </div>

      <!-- Share & Embed -->
      <div class="grid md:grid-cols-2 gap-6 mb-10">
        <div class="card-elevated p-5">
          <h2 class="font-semibold text-neutral-900 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
            </svg>
            Share Your Results
          </h2>
          <ShareButtons title={title} url={currentUrl} />
        </div>
        <div class="card-elevated p-5">
          <EmbedCodeGenerator embedUrl={embedUrl} title={calculatorName} />
        </div>
      </div>

      <!-- FAQs -->
      {faqs.length > 0 && (
        <section class="mb-10">
          <h2 class="heading-md text-neutral-900 mb-6">Frequently Asked Questions</h2>
          <div class="space-y-3">
            {faqs.map((faq) => (
              <details class="card-elevated p-5 group">
                <summary class="font-medium text-neutral-900 cursor-pointer list-none flex justify-between items-center gap-4">
                  <span>{faq.question}</span>
                  <svg class="w-5 h-5 text-neutral-400 flex-shrink-0 group-open:rotate-180 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </summary>
                <p class="mt-4 text-neutral-600 leading-relaxed">{faq.answer}</p>
              </details>
            ))}
          </div>
        </section>
      )}

      <!-- Additional Content Slot -->
      <slot name="content" />

      <!-- Related Calculators -->
      <RelatedCalculators calculators={relatedCalculators} />
    </article>
  </div>
</BaseLayout>
